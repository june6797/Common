public class SingleContactContractGenerator {

    public static void createContractForContact(Id contactId) {
        List<Subscription__c> subs = [
            SELECT Id, Term__c, StartDate__c, EndDate__c,
                   ContactId__c, ContactId__r.AccountId,
                   ProductId__r.MonthlyPrice__c, ProductId__r.Name
            FROM Subscription__c
            WHERE ContactId__c = :contactId
              AND ContractId__c = NULL
              AND Status__c != 'ì·¨ì†Œë¨'
        ];

        if (subs.isEmpty()) {
            System.debug('ğŸ“­ ê³„ì•½ë˜ì§€ ì•Šì€ êµ¬ë…ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        Id accountId = subs[0].ContactId__r.AccountId;
        if (accountId == null) {
            System.debug('â— Contactì— í•™ë¶€ëª¨(Account)ê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            return;
        }

        Decimal total = 0;
        for (Subscription__c s : subs) {
            Decimal unit = s.ProductId__r.MonthlyPrice__c;
            Integer months = s.Term__c != null ? s.Term__c.intValue() : 0;
            total += unit * months;
        }

        Contract con = new Contract(
            AccountId = accountId,
            Status = 'Draft',
            Original_Total_Amount__c = total
        );
        insert con;

        for (Subscription__c s : subs) {
            s.ContractId__c = con.Id;
        }
        update subs;

        System.debug('âœ… ê³„ì•½ ìƒì„± ì™„ë£Œ! ContractId: ' + con.Id);
    }
}